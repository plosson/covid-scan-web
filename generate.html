<!doctype html>

<html lang="en" xmlns:x-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Covid Safe Web</title>
    <meta name="description" content="Covid Safe Web">
    <meta name="author" content="Covid Safe Web">

    <meta property="og:title" content="Covid Safe Web">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://covid-safe.link/">
    <meta property="og:description" content="Generate your own personalized ticket !">
    <meta property="og:image" content="/public/img/favicon-152x152.png">

    <link rel="icon" type="image/png" sizes="32x32" href="/public/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/public/img/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="152x152" href="/public/img/favicon-152x152.png">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/public/img/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/public/img/touch-icon-ipad.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/public/img/touch-icon-iphone-retina.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/public/img/touch-icon-ipad-retina.png">
    <meta name="application-name"
          content="CovidSafe - The unofficial Belgian site to create your personal digital certificates"/>

    <link href="//unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600&display=swap"
          rel="stylesheet">
    <script src="/bundle.js"></script>
    <script src="//cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.13/lottie.min.js" type="text/javascript"></script>
    <script src="//unpkg.com/@alpinejs/persist@3.x.x/dist/cdn.min.js" type="text/javascript" defer></script>
    <script src="//unpkg.com/alpinejs@3.x.x" type="text/javascript" defer></script>
    <script type="text/javascript">
        function data() {
            return {
                "library": this.$persist([]),
                "pass": {
                    "firstName": this.$persist(""),
                    "lastName": this.$persist(""),
                    "purpose": "",
                    "message": ""
                },
                "example": "Beer",
                "view": "form",
                "complete": function () {
                    return this.pass.firstName && this.pass.lastName && this.pass.purpose;
                },
                "cst": function () {
                    if (this.pass.purpose) {
                        return this.pass.purpose.substr(0, 1).toUpperCase() + "ST";
                    } else {
                        return "CST";
                    }
                },
                "generate": function () {
                    this.library.push(this.pass);
                    const text = dgc.encodeDGC(this.pass);
                    document.getElementById("qrcode").innerHTML = "";
                    document.getElementById("qrcode-large").innerHTML = "";
                    this.qrcode = new QRCode(document.getElementById("qrcode"), {
                        text: dgc.encodeDGC(this.pass),
                        width: 200,
                        height: 200,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                    this.qrcode = new QRCode(document.getElementById("qrcode-large"), {
                        text: dgc.encodeDGC(this.pass),
                        width: 300,
                        height: 300,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });

                    bodymovin.destroy();
                    bodymovin.loadAnimation({
                        container: document.getElementById('bm'),
                        renderer: 'svg',
                        loop: true,
                        autoplay: true,
                        path: '/public/json/qr_code.json'
                    });

                    bodymovin.loadAnimation({
                        container: document.getElementById('bm-large'),
                        renderer: 'svg',
                        loop: true,
                        autoplay: true,
                        path: '/public/json/qr_code.json'
                    });

                    this.view = 'qr';
                },
                "init": function () {
                    setInterval(function () {
                        //this.exampleIndex = (this.exampleIndex + 1) % this.examples.length;
                        this.example = dgc.randomName();
                    }.bind(this), 2000);//run this thang every 2 seconds
                },
            }
        }

        function makeid(length) {
            var result = '';
            var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            var charactersLength = characters.length;
            for (var i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() *
                    charactersLength));
            }
            return result;
        }
    </script>
    <style type="text/css">
        #qr-content{
            max-height: 150px;
            max-width: 150px;
            position: relative;
        }

        #qr-content-large {
            max-height: 500px;
            max-width: 500px;
            position: relative;
        }
        #qr-content #bm, #qr-content #bm-large {
            width: 100%;
            height: 100%;
        }
        #qrcode, #qrcode-large {
            width: 90%;
            height: 90%;
            position: absolute;
            left: 5%;
            top: 5%;
        }
    </style>
</head>

<body x-data="data" id="body" class="flex flex-col h-full">
<div id="form" class="w-full" x-show="view=='form'">
    <form class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4 flex flex-col">
        <div class="mb-4">
            <h1>Generate your <span x-text="example" class="underline font-bold"></span> Safe Ticket</h1>
        </div>
        <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="firstName">
                First Name (*)
            </label>
            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                   id="firstName" type="text" placeholder="John" x-model="pass.firstName">
        </div>
        <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="lastName">
                Last Name (*)
            </label>
            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                   id="lastName" type="text" placeholder="Denver" x-model="pass.lastName">
        </div>
        <div class="mb-6">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="purpose">
                What do I want ? (*)
            </label>
            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                   id="purpose" type="text" placeholder="Beer" x-model="pass.purpose">
        </div>
        <div class="mb-6">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="purpose">
                My personal message to the scanner !
            </label>
            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                   id="message" type="text" placeholder="Please, please, let me in !!" x-model="pass.message">
        </div>
        <div class="mt-2" x-show="complete()">
            <a href="#" x-on:click="generate"
               class="content-center bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Generate
                my <span
                        x-text="cst"></span></a>
        </div>
    </form>
</div>
<div id="qr" x-show="view=='qr'" class="p-4 flex flex-col items-center bg-green-50 h-screen">
    <div class=""><span x-text="cst"></span></div>
    <div id="qr-content" class="w-7/12">
        <div id="bm"></div>
        <div id="qrcode" class="w-7/12" x-on:click="view='details'"></div>
    </div>
    <div id="info">
        <p class="text-xs mt-2">Tap the QR-code to enlarge</p>
    </div>
    <div class="w-11/12 mt-5 p-3 bg-black text-gray-200 relative overflow-hidden rounded-xl flex flex-col"
         style="background-image: url('/public/img/eu_avatar_big_light_cropped.png'); background-repeat: no-repeat; background-position: right 0 top 0;">
        <div class="mb-2">
            <p class="text-xs">Last name</p>
            <p><span x-text="pass.lastName"></span></p>
        </div>
        <div class="mb-2">
            <p class="text-xs">Given name</p>
            <p><span x-text="pass.firstName"></span></p>
        </div>
        <div class="mb-2">
            <p class="text-xs">What I want ? </p>
            <p><span x-text="pass.purpose"></span></p>
        </div>
        <div>
            <p class="text-xs">My Personal Message</p>
            <p><span x-text="pass.message"></span></p>
        </div>
    </div>
    <div class="mt-3">
        <a href="#" x-on:click="view='form'">Create another QR code</a>
    </div>
</div>
<div id="qr-detail" x-show="view=='details'" class="p-4 flex flex-col h-screen items-center">
    <div id="qr-content-large" class="mt-20">
        <div id="bm-large"></div>
        <div id="qrcode-large" class="w-11/12"></div>
    </div>
    <div class="mt-5">
        <a href="#" x-on:click="view='qr'" class="font-bold">Back to overview</a>
    </div>
</div>
</body>
</html>
